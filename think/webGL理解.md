# webGL 理解

webGL 知识请看 <https://webglfundamentals.org/webgl/lessons/zh_cn/>

## webGL 核心

- webGL 核心只有两个，顶点着色器，片段着色器

- webGL API 大部分是和着色器打交道，进行数据传输，处理

- THREE.js 中的 camera，scene，renderer 等是上层的封装，并不是 webGL 中的概念。是封装后设计抽离出来的概念，便于交流，宣传，理解

## 顶点着色器

顶点着色器是 GLSL 中写的一个方法，每个顶点调用一次，在这个方法中可以做一些数学运算，然后设置一个 gl_Position 变量，这个变量是该顶点转换到裁剪空间（webGL 空间，-1 到+1），然后 GPU 接收这个值

## 片段着色器

片段着色器是 GLSL 中写的一个方法，每个像素调用一次，设置一个 gl_FragColor 变量，实现自定义像素颜色

## 着色器流程

如果你告诉 webGL 要画三角形，则顶点着色器每完成三次顶点处理，就会用这三个顶点画一个三角形，然后会对这个三角形中的每个像素点进行处理（即光栅化），每个像素调用片段着色器获取颜色

## 缓冲区

- 缓冲区是计算机中用于临时存储数据的一段内存空间，它在计算机图形学中用于存储顶点数据、颜色数据、纹理坐标等数据。在 WebGL 中，缓冲区是一种数据结构，用于存储顶点数据、索引数据等，可以在 GPU 中进行高效的并行计算和渲染，从而提高了图形渲染的效率和性能。

- 缓存区可以将数据存储在GPU的显存中，即在GPU显存中开辟一块区域用来存储数据，然后可以高效的读取和处理这些数据，减少了从cpu读取数据，再传输到GPU。

- 缓冲区创建完在程序运行过程中会一直存在。对于临时存储数据的理解，并不是说用完立马销毁，是指数据不需要长期保存，可以在程序运行过程中暂时存储，以便程序可以对这些数据进行处理和操作。这些数据可能需要在程序的不同阶段中使用，但在程序结束后，这些数据通常不需要再保留，所以在程序的运行过程中会一直存在。

- 即使没有使用缓冲区，程序结束后，程序使用的数据也会被释放，不再保留，操作系统本身就是这样设计的。但是这样的程序是在cpu中的。你可以不使用缓存区，这样将会有频繁的cpu到gpu数据传输，效率很低。优化手段就是使用缓存区，在显存中开辟一块内存区域，在GPU显存进行渲染的时候，从这块缓存区内存读取数据，大大增加效率

- 顶点缓冲区（Vertex Buffer）用于存储顶点数据，例如顶点坐标、法向量、颜色等。顶点缓冲区可以通过 gl.createBuffer() 函数创建，通过 gl.bindBuffer() 函数将其绑定到 WebGL 上下文的 ARRAY_BUFFER 目标上，通过 gl.bufferData() 函数将数据写入缓冲区中。

- 索引缓冲区（Index Buffer）用于存储三角形的顶点索引，以便进行三角形的绘制。索引缓冲区可以通过 gl.createBuffer() 函数创建，通过 gl.bindBuffer() 函数将其绑定到 WebGL 上下文的 ELEMENT_ARRAY_BUFFER 目标上，通过 gl.bufferData() 函数将数据写入缓冲区中。

## 矩阵
